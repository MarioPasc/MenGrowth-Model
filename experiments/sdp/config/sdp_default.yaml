# experiments/sdp/config/sdp_default.yaml
# =============================================================================
# SDP Experiment Configuration — Default
# =============================================================================
# Inherits structure from src/growth/config/phase2_sdp.yaml.
# Provides real paths and data split configuration.

# =============================================================================
# Paths (override per machine)
# =============================================================================
paths:
  checkpoint_dir: /media/mpascual/Sandisk2TB/research/growth-dynamics/growth/checkpoints/BrainSegFounder_finetuned_BraTS
  lora_checkpoint: /media/mpascual/Sandisk2TB/research/growth-dynamics/growth/results/BrainSegFounder_adaptation/LoRA_Adaptation/lora_ablation_semantic_heads/conditions/lora_r16
  data_root: /media/mpascual/PortableSSD/Meningiomas/BraTS/BraTS_Men_Train
  h5_file: /media/mpascual/Sandisk2TB/research/growth-dynamics/growth/data/brats_men_train.h5
  output_dir: /media/mpascual/Sandisk2TB/research/growth-dynamics/growth/results/SDP_Module
  features_dir: /media/mpascual/Sandisk2TB/research/growth-dynamics/growth/data/features/lora_semantic_heads_r16

# =============================================================================
# Data Splits
# =============================================================================
data:
  train_splits: [lora_train, sdp_train]  # Combined for SDP training
  val_split: lora_val                     # Validation
  test_split: test                        # Held-out evaluation
  splits_config: experiments/lora_ablation/config/local/LoRA_semantic_heads_icai.yaml

# =============================================================================
# SDP Architecture (from phase2_sdp.yaml)
# =============================================================================
sdp:
  in_dim: 768
  hidden_dim: 512
  out_dim: 128
  dropout: 0.3
  spectral_norm: all

partition:
  vol_dim: 24
  loc_dim: 12
  shape_dim: 12
  residual_dim: 80

targets:
  n_vol: 4
  n_loc: 3
  n_shape: 1
  shape_indices: [0]  # sphericity only (solidity has ceiling R²=0.14, unpredictable)

# =============================================================================
# Loss
# =============================================================================
loss:
  lambda_vol: 20.0
  lambda_loc: 10.0
  lambda_shape: 30.0
  lambda_cov: 15.0
  lambda_var: 5.0
  lambda_dcor: 8.0
  gamma_var: 1.0

# =============================================================================
# Curriculum
# =============================================================================
curriculum:
  enabled: false
  warmup_end: 10
  semantic_end: 60
  independence_end: 120

# =============================================================================
# Training
# =============================================================================
training:
  seed: 42
  max_epochs: 300
  lr: 1.0e-3
  weight_decay: 0.01
  batch_size: 128
  optimizer: adamw
  gradient_clip_val: 1.0
  scheduler:
    type: cosine
    warmup_epochs: 10
    min_lr: 1.0e-6
  precision: 32-true
  accelerator: auto
  devices: 1

# =============================================================================
# Normalization
# =============================================================================
normalization:
  scope: train_only
  features: true
  targets: true

# =============================================================================
# Feature Extraction
# =============================================================================
feature_extraction:
  level: encoder10
  batch_size: 1
  num_workers: 4
  roi_size: [192, 192, 192]

# =============================================================================
# Logging
# =============================================================================
logging:
  log_every_n_steps: 1
